<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2048 Game</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #faf8ef;
      font-family: Arial, sans-serif;
      position: relative;
    }
    .game-container {
      background: #bbada0;
      padding: 15px;
      border-radius: 10px;
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-gap: 15px;
      position: relative;
      transition: all 0.3s ease;
    }
    .tile {
      width: 100px;
      height: 100px;
      background: #cdc1b4;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2em;
      font-weight: bold;
      color: #776e65;
      transition: transform 0.2s ease, left 0.2s ease, top 0.2s ease;
      position: relative;
    }
    .game-over, .game-win {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(238, 228, 218, 0.9);
      padding: 20px 40px;
      font-size: 2em;
      font-weight: bold;
      color: #776e65;
      border-radius: 10px;
      display: none;
      text-align: center;
    }
    .retry-btn, .continue-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1em;
      background: #8f7a66;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .retry-btn:hover, .continue-btn:hover {
      background: #9c8b7a;
    }
    .control-menu {
      position: absolute;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(238, 228, 218, 0.95);
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 100;
      text-align: center;
    }
    .control-menu input {
      padding: 10px;
      font-size: 1em;
      width: 150px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .control-menu button {
      margin-left: 10px;
      padding: 10px 15px;
      font-size: 1em;
      border: none;
      background: #8f7a66;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
    }
    .control-menu button:hover {
      background: #9c8b7a;
    }
  </style>
</head>
<body>
  <div class="game-container" id="game"></div>
  <div class="game-over" id="gameOver">
    Game Over<br>
    <button class="retry-btn" onclick="retryGame()">Retry</button>
  </div>
  <div class="game-win" id="gameWin">
    You Win!<br>
    <button class="continue-btn" onclick="continueGame()">Continue</button>
  </div>

  <div class="control-menu" id="controlMenu">
    Enter Code: <input type="text" id="codeInput" placeholder="code">
    <button onclick="submitCode()">Submit</button>
  </div>

  <script>
    const game = document.getElementById('game');
    const gameOverScreen = document.getElementById('gameOver');
    const gameWinScreen = document.getElementById('gameWin');
    const controlMenu = document.getElementById('controlMenu');
    const codeInput = document.getElementById('codeInput');
    let grid;
    let autoPlayInterval = null;

    let boardSize = 4;

    function startGame() {
      grid = Array(boardSize).fill().map(() => Array(boardSize).fill(0));
      addRandomTile();
      addRandomTile();
      draw();
      gameOverScreen.style.display = 'none';
      gameWinScreen.style.display = 'none';
      stopAutoPlay();
      updateGridStyle();
    }

    function updateGridStyle() {
      game.style.gridTemplateColumns = `repeat(${boardSize}, 100px)`;
    }

    function retryGame() { startGame(); }
    function continueGame() { gameWinScreen.style.display = 'none'; draw(); }

    function addRandomTile() {
      let empty = [];
      for (let r = 0; r < boardSize; r++) {
        for (let c = 0; c < boardSize; c++) {
          if (grid[r][c] === 0) empty.push({ r, c });
        }
      }
      if (empty.length > 0) {
        let { r, c } = empty[Math.floor(Math.random() * empty.length)];
        grid[r][c] = Math.random() < 0.9 ? 2 : 4;
      }
    }

    function draw() {
      game.innerHTML = '';
      for (let r = 0; r < boardSize; r++) {
        for (let c = 0; c < boardSize; c++) {
          const tile = document.createElement('div');
          tile.className = 'tile';
          if (grid[r][c] !== 0) {
            tile.textContent = grid[r][c];
            tile.style.background = getTileColor(grid[r][c]);
          }
          game.appendChild(tile);
          if(grid[r][c] === 2048) showWin();
        }
      }
      checkGameOver();
    }

    function showWin() { gameWinScreen.style.display = 'block'; stopAutoPlay(); }

    function getTileColor(value) {
      const colors = {
        2: '#eee4da', 4: '#ede0c8', 8: '#f2b179', 16: '#f59563', 32: '#f67c5f',
        64: '#f65e3b', 128: '#edcf72', 256: '#edcc61', 512: '#edc850',
        1024: '#edc53f', 2048: '#edc22e'
      };
      return colors[value] || '#3c3a32';
    }

    function slide(row) {
      row = row.filter(val => val);
      for (let i = 0; i < row.length - 1; i++) { if (row[i] === row[i + 1]) { row[i] *= 2; row[i + 1] = 0; } }
      row = row.filter(val => val);
      while (row.length < boardSize) row.push(0);
      return row;
    }

    function transpose(matrix) { return matrix[0].map((_, c) => matrix.map(row => row[c])); }
    function moveLeft() { animateMove(() => grid.map(row => slide(row))); }
    function moveRight() { animateMove(() => grid.map(row => slide(row.slice().reverse()).reverse())); }
    function moveUp() { animateMove(() => transpose(transpose(grid).map(row => slide(row)))); }
    function moveDown() { animateMove(() => transpose(transpose(grid).map(row => slide(row.slice().reverse()).reverse()))); }

    function animateMove(moveFunc) {
      const oldGrid = JSON.parse(JSON.stringify(grid));
      const newGrid = moveFunc();
      if (JSON.stringify(oldGrid) !== JSON.stringify(newGrid)) {
        grid = newGrid;
        addRandomTile();
        draw();
      }
    }

    function checkGameOver() {
      for (let r = 0; r < boardSize; r++) {
        for (let c = 0; c < boardSize; c++) {
          if (grid[r][c] === 0) return;
          if (c < boardSize - 1 && grid[r][c] === grid[r][c + 1]) return;
          if (r < boardSize - 1 && grid[r][c] === grid[r + 1][c]) return;
        }
      }
      gameOverScreen.style.display = 'block';
      stopAutoPlay();
    }

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') moveLeft();
      else if (e.key === 'ArrowRight') moveRight();
      else if (e.key === 'ArrowUp') moveUp();
      else if (e.key === 'ArrowDown') moveDown();
      else if (e.key.toLowerCase() === 'c') controlMenu.style.display = 'block';
    });

    function submitCode() {
      const code = codeInput.value.toLowerCase();
      if (code === 'bot') startAutoPlay();
      else if (code === 'extra') {
        boardSize = 8; // 2x bigger instead of 3x
        startGame();
      }
      controlMenu.style.display = 'none';
      codeInput.value = '';
    }

    function startAutoPlay() {
      stopAutoPlay();
      autoPlayInterval = setInterval(() => { const moves = [moveUp, moveRight, moveDown, moveLeft]; moves[Math.floor(Math.random() * moves.length)](); }, 500);
    }

    function stopAutoPlay() { if (autoPlayInterval) clearInterval(autoPlayInterval); autoPlayInterval = null; }

    startGame();
  </script>
</body>
</html>
